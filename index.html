<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà S. suis ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ - 5 ‡∏î‡πà‡∏≤‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏° AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0fdf4;
            overscroll-behavior-y: contain;
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö Header ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
        header {
            background-color: white;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .card-container {
            perspective: 1000px;
        }

        .card {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 0.5rem;
            text-align: center;
        }

        .card-front {
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            color: white;
            font-size: 2rem;
        }

        .card-back {
            background-color: white;
            transform: rotateY(180deg);
            border: 2px solid #059669;
            color: #064e3b;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .text-content {
            font-size: 0.85rem;
            line-height: 1.3;
        }

        @media (max-width: 640px) {
            .text-content {
                font-size: 0.7rem;
            }
        }

        .matched {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1) rotateY(180deg);
            }

            50% {
                transform: scale(1.1) rotateY(180deg);
            }

            100% {
                transform: scale(1) rotateY(180deg);
            }
        }

        .level-dot {
            transition: all 0.3s ease;
        }

        .level-dot.active {
            background-color: #059669;
            color: white;
            border-color: #059669;
            transform: scale(1.1);
        }

        .level-dot.completed {
            background-color: #34d399;
            color: white;
            border-color: #34d399;
        }

        .level-line {
            height: 4px;
            flex-grow: 1;
            background-color: #e5e7eb;
            margin: 0 4px;
            border-radius: 2px;
        }

        .level-line.filled {
            background-color: #34d399;
        }

        /* AI Box Animation */
        .ai-pulse {
            animation: ai-glow 2s infinite;
        }

        @keyframes ai-glow {
            0% {
                box-shadow: 0 0 5px #a7f3d0;
            }

            50% {
                box-shadow: 0 0 15px #34d399;
            }

            100% {
                box-shadow: 0 0 5px #a7f3d0;
            }
        }

        .typing-loader::after {
            content: '...';
            animation: typing 1.5s steps(4, end) infinite;
        }

        @keyframes typing {

            0%,
            100% {
                content: '';
            }

            25% {
                content: '.';
            }

            50% {
                content: '..';
            }

            75% {
                content: '...';
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center py-6 px-4 pb-24">

    <!-- Welcome / Instructions Screen -->
    <div id="welcome-screen" class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 mt-4 text-center">
        <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-bacteria text-5xl text-green-600"></i>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold text-green-800 mb-2">S. suis ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ</h1>
        <p class="text-gray-500 mb-8">‡πÄ‡∏Å‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏´‡∏π‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏™‡∏∏‡∏Å‡∏£</p>

        <div class="bg-green-50 rounded-xl p-6 mb-8 text-left border border-green-200">
            <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center">
                <i class="fas fa-gamepad mr-2 text-green-600"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
            </h2>
            <ul class="space-y-3 text-gray-700 text-sm md:text-base">
                <li class="flex items-start">
                    <i class="fas fa-bullseye text-red-500 mt-1 mr-2 w-5"></i>
                    <span><strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-hand-pointer text-blue-500 mt-1 mr-2 w-5"></i>
                    <span><strong>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏•‡∏¥‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á
                        <span class="text-orange-600 font-bold">‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏™‡∏µ‡∏™‡πâ‡∏°)</span> ‡πÅ‡∏•‡∏∞ <span
                            class="text-green-600 font-bold">‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)</span></span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-lightbulb text-yellow-500 mt-1 mr-2 w-5"></i>
                    <span><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏à‡∏≠ "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?" ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö "‡∏ó‡∏£‡∏á‡∏Å‡∏•‡∏°
                        (Coccus)"</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2 w-5"></i>
                    <span><strong>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ñ‡∏π‡∏Å:</strong> ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å ‚úÖ</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-robot text-purple-500 mt-1 mr-2 w-5"></i>
                    <span><strong>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏© (AI Corner):</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏•‡πà‡∏≠‡∏á "‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏û‡∏µ‡πà AI"
                        ‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏Å‡∏î‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ üîä)</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-trophy text-yellow-600 mt-1 mr-2 w-5"></i>
                    <span><strong>‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö ‡∏à‡∏∞‡∏°‡∏µ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
                </li>
            </ul>
        </div>

        <button onclick="onStartGame()"
            class="bg-green-600 hover:bg-green-700 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 w-full md:w-auto">
            <i class="fas fa-play mr-2"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢!
        </button>
    </div>

    <!-- Main Game Container (Initially Hidden) -->
    <div id="game-container" class="w-full flex flex-col items-center hidden">
        <!-- Header & Level Progress -->
        <header class="w-full max-w-4xl mb-6">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-green-800">
                        <i class="fas fa-bacteria mr-2"></i>S. suis ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ
                    </h1>
                    <p id="level-title" class="text-green-600 text-sm md:text-base font-medium mt-1">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1:
                        ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</p>
                </div>

                <div class="flex gap-3 text-sm font-bold text-gray-700">
                    <button onclick="openMultiplayerModal()" id="btn-multiplayer"
                        class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-full shadow-sm border border-blue-200 flex items-center transition-colors">
                        <i class="fas fa-users mr-2"></i> <span id="multiplayer-status">‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</span>
                    </button>
                    <div class="bg-white px-3 py-1 rounded-full shadow-sm border border-green-100 flex items-center">
                        <i class="fas fa-stopwatch mr-2 text-blue-500"></i>
                        <span id="time">00:00</span>
                    </div>
                    <div class="bg-white px-3 py-1 rounded-full shadow-sm border border-green-100 flex items-center">
                        <i class="fas fa-star mr-2 text-yellow-500"></i>
                        <span id="moves">0</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-between px-2">
                <div class="level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm active"
                    id="dot-1">1</div>
                <div class="level-line" id="line-1"></div>
                <div class="level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm"
                    id="dot-2">2</div>
                <div class="level-line" id="line-2"></div>
                <div class="level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm"
                    id="dot-3">3</div>
                <div class="level-line" id="line-3"></div>
                <div class="level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm"
                    id="dot-4">4</div>
                <div class="level-line" id="line-4"></div>
                <div class="level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm"
                    id="dot-5">5</div>
            </div>
        </header>

        <!-- Game Board -->
        <div id="game-board" class="grid w-full max-w-4xl mx-auto transition-all duration-300 mb-8">
            <!-- Cards will be generated here -->
        </div>



        <!-- AI Knowledge Corner -->
        <div id="ai-corner"
            class="w-full max-w-4xl bg-white rounded-xl shadow-lg border border-green-200 overflow-hidden hidden transition-all duration-500 mt-8">
            <div
                class="bg-gradient-to-r from-green-100 to-emerald-50 p-3 border-b border-green-200 flex justify-between items-center">
                <h3 class="font-bold text-green-800 flex items-center">
                    <i class="fas fa-sparkles text-yellow-500 mr-2"></i>
                    ‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏û‡∏µ‡πà AI
                </h3>
                <span class="text-xs text-green-600 bg-white px-2 py-1 rounded-full border border-green-100">Powered by
                    Gemini</span>
            </div>
            <div class="p-4">
                <div id="ai-loading" class="hidden text-green-600 italic">
                    <i class="fas fa-robot mr-2 animate-bounce"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ<span
                        class="typing-loader"></span>
                </div>
                <div id="ai-content" class="hidden">
                    <p id="ai-text" class="text-gray-700 leading-relaxed mb-3"></p>
                    <button onclick="playAIAudio()" id="btn-play-audio"
                        class="text-sm bg-green-100 hover:bg-green-200 text-green-700 py-1 px-3 rounded-full transition-colors flex items-center w-max">
                        <i class="fas fa-volume-up mr-2"></i> ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢
                    </button>
                    <div id="audio-loading" class="hidden text-xs text-green-600 mt-1">
                        <i class="fas fa-circle-notch fa-spin mr-1"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á...
                    </div>
                </div>
                <div id="ai-empty" class="text-gray-400 text-center py-2 text-sm italic">
                    ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ!
                </div>
            </div>
        </div>

        <!-- Manual Knowledge Box Trigger -->
        <div class="w-full max-w-4xl flex flex-col items-center mt-8 mb-6">
            <button onclick="toggleKnowledgeBox()"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 flex items-center">
                <i class="fas fa-book-open mr-2"></i> ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
            </button>

            <div id="manual-knowledge-box"
                class="w-full mt-4 bg-gray-50 rounded-xl shadow-lg border border-indigo-200 hidden transition-all duration-300">
                <!-- Knowledge Hub Container -->
                <div class="p-6">
                    <header class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-2">Knowledge Hub: ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</h2>
                        <p class="text-gray-600 text-sm">‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏î‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏Ñ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏™‡∏∏‡∏Å‡∏£</p>
                    </header>

                    <!-- Tabs -->
                    <div class="flex rounded-lg bg-gray-200 p-1 mb-6 shadow-inner">
                        <button onclick="switchTab('antibiotics')" id="tab-antibiotics"
                            class="flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 bg-white text-indigo-700 shadow-sm">
                            ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞
                        </button>
                        <button onclick="switchTab('ssuis')" id="tab-ssuis"
                            class="flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 text-gray-600 hover:text-gray-800">
                            ‡πÇ‡∏£‡∏Ñ‡∏™‡πÄ‡∏ï‡∏£‡∏õ‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏Ñ‡∏Ñ‡∏±‡∏™ ‡∏ã‡∏π‡∏≠‡∏¥‡∏™
                        </button>
                    </div>

                    <!-- Content Header -->
                    <div id="section-header" class="mb-6 text-center">
                        <h2 class="text-lg font-bold text-gray-800 mb-1" id="section-title">‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞
                        </h2>
                        <p class="text-gray-500 text-sm" id="section-subtitle">
                            ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå</p>
                    </div>

                    <!-- Accordion Container -->
                    <div id="accordion-container" class="space-y-2">
                        <!-- Content will be injected here via JS -->
                    </div>

                    <footer class="mt-8 text-center text-gray-400 text-xs">
                        <p>¬© 2024 Livestock Health Knowledge Base. Based on One Health Concept.</p>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (Level & Victory) -->
    <div id="level-modal"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div
            class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4 transform scale-100 animate-bounce-short">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-3xl text-green-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô <span id="modal-level-num">1</span>!</h2>
            <p class="text-gray-600 mb-4" id="modal-msg">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</p>
            <div class="flex justify-center gap-4 mb-6 text-sm">
                <div class="text-gray-500"><i class="fas fa-clock mr-1"></i> <span id="level-time">00:00</span></div>
                <div class="text-gray-500"><i class="fas fa-hand-pointer mr-1"></i> <span id="level-moves">0</span>
                    ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
            </div>
            <button onclick="nextLevel()"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 flex items-center justify-center">
                ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <div id="victory-modal"
        class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden backdrop-blur-md">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500">
            </div>
            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-trophy text-4xl text-yellow-600"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç S. suis!</h2>
            <p class="text-gray-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö 5 ‡∏î‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</p>
            <div class="bg-gray-50 p-4 rounded-xl mb-6">
                <p class="text-sm text-gray-500 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <p class="text-2xl font-bold text-green-600" id="total-time">00:00</p>
            </div>
            <button onclick="restartGame()"
                class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-8 rounded-xl transition duration-300">
                <i class="fas fa-redo mr-2"></i> ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            </button>
        </div>
    </div>

    <!-- Multiplayer Modal -->
    <div id="multiplayer-modal"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full mx-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-wifi text-blue-500 mr-2"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
            </h2>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (Room ID)</label>
                <input type="text" id="room-id-input"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô room123">
                <p class="text-xs text-gray-500 mt-1">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</p>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('multiplayer-modal').classList.add('hidden')"
                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button onclick="connectMQTT()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt.min.js"></script>
    <script>
        // TODO: Insert your Google Gemini API Key here to enable AI features (Explanation & TTS)
        const apiKey = "AIzaSyBBqJqIg6CTShy1mvyD22N9ynaMKGmFeoM";

        // --- Game Data (5 Levels) ---
        const levelsData = [
            {
                title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô",
                pairs: [
                    { id: "1-1", text: "S. suis ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", icon: "fa-question-circle", type: "q" },
                    { id: "1-1", text: "‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏ß‡∏Å", icon: "fa-bacterium", type: "a" },
                    { id: "1-2", text: "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", icon: "fa-question-circle", type: "q" },
                    { id: "1-2", text: "‡∏ó‡∏£‡∏á‡∏Å‡∏•‡∏° (Coccus)", icon: "fa-circle", type: "a" },
                    { id: "1-3", text: "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°?", icon: "fa-question-circle", type: "q" },
                    { id: "1-3", text: "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (Non-motile)", icon: "fa-ban", type: "a" }
                ]
            },
            {
                title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢?",
                pairs: [
                    { id: "2-1", text: "‡πÇ‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ‡∏ï‡∏¥‡∏î‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", icon: "fa-people-arrows", type: "q" },
                    { id: "2-1", text: "‡πÑ‡∏î‡πâ (Zoonotic Agent)", icon: "fa-check-circle", type: "a" },
                    { id: "2-2", text: "‡∏´‡∏°‡∏π‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏´‡∏ô‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î?", icon: "fa-piggy-bank", type: "q" },
                    { id: "2-2", text: "5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", icon: "fa-calendar-week", type: "a" },
                    { id: "2-3", text: "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏°‡∏π‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", icon: "fa-skull-crossbones", type: "q" },
                    { id: "2-3", text: "‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 5-20%", icon: "fa-percentage", type: "a" },
                    { id: "2-4", text: "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏û‡∏≤‡∏´‡∏∞‡πÉ‡∏ô‡∏ù‡∏π‡∏á‡∏™‡∏π‡∏á‡πÑ‡∏´‡∏°?", icon: "fa-viruses", type: "q" },
                    { id: "2-4", text: "‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 100%", icon: "fa-chart-pie", type: "a" }
                ]
            },
            {
                title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏",
                pairs: [
                    { id: "3-1", text: "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÑ‡∏´‡∏ô?", icon: "fa-route", type: "q" },
                    { id: "3-1", text: "‡∏ó‡∏≤‡∏á‡∏õ‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏°‡∏π‡∏Å", icon: "fa-head-side-mask", type: "a" },
                    { id: "3-2", text: "‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÉ‡∏î‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢?", icon: "fa-bolt", type: "q" },
                    { id: "3-2", text: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î (Stress)", icon: "fa-tired", type: "a" },
                    { id: "3-3", text: "‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏•‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á?", icon: "fa-wind", type: "q" },
                    { id: "3-3", text: "‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏î‡∏µ", icon: "fa-smog", type: "a" },
                    { id: "3-4", text: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏û‡∏≤‡∏´‡∏∞‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?", icon: "fa-spider", type: "q" },
                    { id: "3-4", text: "‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô ‡∏ô‡∏Å ‡∏´‡∏ô‡∏π", icon: "fa-crow", type: "a" },
                    { id: "3-5", text: "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ?", icon: "fa-industry", type: "q" },
                    { id: "3-5", text: "‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ", icon: "fa-users-slash", type: "a" },
                    { id: "3-6", text: "‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏ä‡∏∑‡πâ‡∏≠?", icon: "fa-sync", type: "q" },
                    { id: "3-6", text: "‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (Continuous)", icon: "fa-arrow-right-arrow-left", type: "a" }
                ]
            },
            {
                title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ",
                pairs: [
                    { id: "4-1", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠?", icon: "fa-exclamation-circle", type: "q" },
                    { id: "4-1", text: "‡∏ï‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô", icon: "fa-cross", type: "a" },
                    { id: "4-2", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?", icon: "fa-brain", type: "q" },
                    { id: "4-2", text: "‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", icon: "fa-biohazard", type: "a" },
                    { id: "4-3", text: "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢?", icon: "fa-walking", type: "q" },
                    { id: "4-3", text: "‡πÄ‡∏î‡∏¥‡∏ô‡πÇ‡∏ã‡πÄ‡∏ã / ‡∏Ç‡∏≤‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", icon: "fa-swimmer", type: "a" },
                    { id: "4-4", text: "‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ç‡∏≤?", icon: "fa-bone", type: "q" },
                    { id: "4-4", text: "‡∏Ç‡πâ‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡∏ö‡∏ß‡∏°", icon: "fa-crutch", type: "a" },
                    { id: "4-5", text: "‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏î‡∏ß‡∏á‡∏ï‡∏≤?", icon: "fa-eye", type: "q" },
                    { id: "4-5", text: "‡∏ï‡∏≤‡∏ö‡∏≠‡∏î", icon: "fa-eye-slash", type: "a" },
                    { id: "4-6", text: "‡πÑ‡∏Ç‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", icon: "fa-thermometer-full", type: "q" },
                    { id: "4-6", text: "105-106 ¬∞F", icon: "fa-fire", type: "a" }
                ]
            },
            {
                title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ (Final Quiz)",
                pairs: [
                    { id: "5-1", text: "‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠?", icon: "fa-pills", type: "q" },
                    { id: "5-1", text: "‡πÄ‡∏û‡∏ô‡∏¥‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô", icon: "fa-prescription-bottle", type: "a" },
                    { id: "5-2", text: "‡∏¢‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", icon: "fa-capsules", type: "q" },
                    { id: "5-2", text: "‡∏≠‡∏∞‡∏°‡πá‡∏≠‡∏Å‡∏ã‡∏µ‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô", icon: "fa-tablets", type: "a" },
                    { id: "5-3", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", icon: "fa-shield-virus", type: "q" },
                    { id: "5-3", text: "‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û", icon: "fa-user-shield", type: "a" },
                    { id: "5-4", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°?", icon: "fa-pump-soap", type: "q" },
                    { id: "5-4", text: "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢/‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠", icon: "fa-broom", type: "a" },
                    { id: "5-5", text: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ?", icon: "fa-vial", type: "q" },
                    { id: "5-5", text: "‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢", icon: "fa-dna", type: "a" },
                    { id: "5-6", text: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∞‡πÑ‡∏£?", icon: "fa-random", type: "q" },
                    { id: "5-6", text: "‡πÇ‡∏£‡∏Ñ‡∏Å‡∏•‡∏≤‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå", icon: "fa-notes-medical", type: "a" },
                    { id: "5-7", text: "‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏∑‡∏≠?", icon: "fa-heart-broken", type: "q" },
                    { id: "5-7", text: "‡∏•‡∏¥‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", icon: "fa-heartbeat", type: "a" },
                    { id: "5-8", text: "‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏õ‡∏≠‡∏î‡∏Ñ‡∏∑‡∏≠?", icon: "fa-lungs-virus", type: "q" },
                    { id: "5-8", text: "‡∏õ‡∏≠‡∏î‡∏ö‡∏ß‡∏°", icon: "fa-lungs", type: "a" }
                ]
            }
        ];

        // --- Game State ---
        let currentLevelIndex = 0;
        let cards = [];
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let moves = 0;
        let matchedPairs = 0;
        let timerInterval;
        let seconds = 0;
        let totalSeconds = 0;
        let gameStarted = false;
        let currentExplanation = "";

        // --- MQTT State ---
        let mqttClient;
        let isMultiplayer = false;
        let roomId = "";
        let isHost = false;
        let myClientId = "client-" + Math.random().toString(16).substr(2, 8);

        // --- DOM Elements ---
        const gameContainer = document.getElementById('game-container');
        const welcomeScreen = document.getElementById('welcome-screen');
        const gameBoard = document.getElementById('game-board');
        const movesDisplay = document.getElementById('moves');
        const timeDisplay = document.getElementById('time');
        const levelTitle = document.getElementById('level-title');
        const levelModal = document.getElementById('level-modal');
        const victoryModal = document.getElementById('victory-modal');

        // AI Elements
        const aiCorner = document.getElementById('ai-corner');
        const aiLoading = document.getElementById('ai-loading');
        const aiContent = document.getElementById('ai-content');
        const aiText = document.getElementById('ai-text');
        const aiEmpty = document.getElementById('ai-empty');
        const audioLoading = document.getElementById('audio-loading');

        // --- Start Game Logic (New) ---
        function onStartGame() {
            // SweetAlert2 Loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°...',
                html: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°!',
                timer: 1500,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading()
                },
                willClose: () => {
                    // Transition Logic
                    welcomeScreen.classList.add('hidden');
                    gameContainer.classList.remove('hidden');
                    initGame(0);
                }
            });
        }

        // --- Init Function ---
        function initGame(levelIndex) {
            currentLevelIndex = levelIndex;
            const levelData = levelsData[levelIndex];

            levelTitle.innerText = levelData.title;
            updateLevelIndicator(levelIndex);

            cards = [...levelData.pairs];
            shuffle(cards);
            resetLevelStats();
            renderBoard();

            // Reset AI box for new level
            aiCorner.classList.remove('hidden');
            resetAIBox();
        }

        function toggleKnowledgeBox() {
            const box = document.getElementById('manual-knowledge-box');
            if (box.classList.contains('hidden')) {
                box.classList.remove('hidden');
                setTimeout(() => box.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
            } else {
                box.classList.add('hidden');
            }
        }

        function resetAIBox() {
            aiLoading.classList.add('hidden');
            aiContent.classList.add('hidden');
            aiEmpty.classList.remove('hidden');
            aiCorner.classList.remove('ai-pulse');
        }

        function updateLevelIndicator(index) {
            for (let i = 0; i < 5; i++) {
                const dot = document.getElementById(`dot-${i + 1}`);
                const line = document.getElementById(`line-${i + 1}`);

                dot.className = "level-dot w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold text-gray-400 text-sm";
                if (line) line.className = "level-line";

                if (i < index) {
                    dot.classList.add('completed', 'bg-green-400', 'border-green-400', 'text-white');
                    if (line) line.classList.add('filled');
                } else if (i === index) {
                    dot.classList.add('active');
                }
            }
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function renderBoard() {
            gameBoard.innerHTML = '';

            const cardCount = cards.length;
            let gridClass = 'grid-cols-3 gap-3';

            if (cardCount === 8) gridClass = 'grid-cols-4 md:grid-cols-4 gap-3';
            if (cardCount >= 12) gridClass = 'grid-cols-3 md:grid-cols-4 gap-2 md:gap-4';
            if (cardCount === 16) gridClass = 'grid-cols-4 gap-2';

            gameBoard.className = `grid ${gridClass} w-full max-w-4xl mx-auto`;

            cards.forEach((item) => {
                const cardElement = document.createElement('div');
                const heightClass = cardCount >= 12 ? 'h-24 md:h-32' : 'h-32 md:h-40';

                // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î className ‡∏ï‡∏£‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Browser/Webview
                cardElement.className = `card-container w-full ${heightClass}`;

                let bgColorClass = item.type === 'q' ? 'bg-orange-50 border-orange-200' : 'bg-green-50 border-green-200';

                // Remove onclick from HTML string and bind event listener programmatically
                cardElement.innerHTML = `
                    <div class="card w-full h-full" data-id="${item.id}">
                        <div class="card-face card-front rounded-xl shadow-md">
                            <i class="fas fa-question text-white opacity-50"></i>
                        </div>
                        <div class="card-face card-back rounded-xl shadow-md ${bgColorClass}">
                            <i class="fas ${item.icon} text-2xl mb-1 ${item.type === 'q' ? 'text-orange-500' : 'text-green-600'}"></i>
                            <span class="text-content ${item.type === 'q' ? 'text-orange-800' : 'text-green-800'}">${item.text}</span>
                        </div>
                    </div>
                `;

                // Add listener to the .card element inside
                const cardInner = cardElement.querySelector('.card');
                cardInner.addEventListener('click', function () {
                    flipCard(this, true); // true = action by local user
                });

                gameBoard.appendChild(cardElement);
            });
        }

        // --- Gameplay Logic ---
        function flipCard(cardWrapper, isLocalAction = false) {
            const card = cardWrapper;

            if (!gameStarted) {
                startTimer();
                gameStarted = true;
                if (isLocalAction && isMultiplayer) sendGameAction('START_TIMER', {});
            }

            if (lockBoard) return;
            if (card === firstCard) return;
            if (card.classList.contains('flipped')) return;

            // MQTT Sync: Send flip action
            if (isLocalAction && isMultiplayer) {
                const cardIndex = Array.from(gameBoard.children).indexOf(card.parentElement);
                sendGameAction('FLIP', { cardIndex: cardIndex });
            }

            card.classList.add('flipped');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = card;
                return;
            }

            secondCard = card;
            incrementMoves();
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.id === secondCard.dataset.id;

            if (isMatch) {
                disableCards();
            } else {
                unflipCards();
            }
        }

        function disableCards() {
            const card1 = firstCard;
            const card2 = secondCard;

            setTimeout(() => {
                const back1 = card1.querySelector('.card-back');
                const back2 = card2.querySelector('.card-back');

                back1.classList.remove('bg-orange-50', 'bg-green-50', 'border-orange-200', 'border-green-200');
                back2.classList.remove('bg-orange-50', 'bg-green-50', 'border-orange-200', 'border-green-200');

                back1.classList.add('bg-green-100', 'border-green-500');
                back2.classList.add('bg-green-100', 'border-green-500');

                back1.innerHTML += '<i class="fas fa-check-circle absolute top-1 right-1 text-green-500 text-xs"></i>';
                back2.innerHTML += '<i class="fas fa-check-circle absolute top-1 right-1 text-green-500 text-xs"></i>';
            }, 200);

            // --- TRIGGER AI EXPLANATION ---
            const text1 = firstCard.querySelector('.text-content').innerText;
            const text2 = secondCard.querySelector('.text-content').innerText;
            // Pass the ID from the first card to use backup knowledge
            fetchAIExplanation(text1, text2, firstCard.dataset.id);

            matchedPairs++;
            resetBoard();

            if (matchedPairs === cards.length / 2) {
                setTimeout(levelComplete, 1500);
            }
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        function incrementMoves() {
            moves++;
            movesDisplay.innerText = moves;
        }

        // --- AI API Logic ---
        const explanationCache = {};

        const backupKnowledge = {
            // ‡∏î‡πà‡∏≤‡∏ô 1: ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠
            "1-1": "S. suis ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏¥‡πã‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏à‡∏∏‡∏•‡∏ó‡∏£‡∏£‡∏®‡∏ô‡πå‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏∞",
            "1-2": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á '‡∏Å‡∏•‡∏°' ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•‡πÄ‡∏•‡∏¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Coccus",
            "1-3": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡∏µ‡πâ‡∏Ç‡∏µ‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏à ‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡πÄ‡∏≠‡∏á (Non-motile)",
            // ‡∏î‡πà‡∏≤‡∏ô 2: ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
            "2-1": "‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡πÇ‡∏£‡∏Ñ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏™‡∏π‡πà‡∏Ñ‡∏ô (Zoonosis) ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï",
            "2-2": "‡∏•‡∏π‡∏Å‡∏´‡∏°‡∏π‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå) ‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏Å‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏•‡∏¢‡∏õ‡πà‡∏ß‡∏¢‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
            "2-3": "‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢ 100 ‡∏ï‡∏±‡∏ß ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á 20 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡∏≤‡∏¢ 5-20%)",
            "2-4": "‡∏´‡∏°‡∏π‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ù‡∏π‡∏á‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÄ‡∏ß‡∏•‡∏≤!",
            // ‡∏î‡πà‡∏≤‡∏ô 3: ‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠
            "3-1": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≤‡∏á '‡∏õ‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏°‡∏π‡∏Å' ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏õ‡∏£‡∏Å",
            "3-2": "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î (Stress) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡∏à‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            "3-3": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó ‡∏à‡∏∞‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÑ‡∏ß‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢",
            "3-4": "‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô ‡∏ô‡∏Å ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏π ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏û‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ‡πÑ‡∏õ‡∏ï‡∏¥‡∏î‡∏´‡∏°‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ",
            "3-5": "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏´‡∏°‡∏π‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏¥‡∏ô‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡∏£‡πà‡πÑ‡∏ß‡∏°‡∏≤‡∏Å",
            "3-6": "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏±‡∏Å‡πÄ‡∏•‡πâ‡∏≤ (All-in All-out) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏∞‡∏™‡∏° ‡∏ï‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£‡πÇ‡∏£‡∏Ñ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ",
            // ‡∏î‡πà‡∏≤‡∏ô 4: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£
            "4-1": "‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏´‡∏°‡∏π‡∏≠‡∏≤‡∏à‡∏ï‡∏≤‡∏¢‡∏Å‡∏∞‡∏ó‡∏±‡∏ô‡∏´‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¢",
            "4-2": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≠‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏°‡∏≠‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡∏´‡∏°‡∏π‡∏à‡∏∞‡∏ä‡∏±‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏á",
            "4-3": "‡∏´‡∏°‡∏π‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ã‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏∏‡∏¢‡∏Ç‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥",
            "4-4": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏ö‡∏ß‡∏°‡πÅ‡∏î‡∏á ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏à‡πá‡∏ö‡∏Ç‡∏≤",
            "4-5": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ï‡∏≤ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏π‡∏ï‡∏≤‡∏ö‡∏≠‡∏î ‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô",
            "4-6": "‡∏´‡∏°‡∏π‡∏à‡∏∞‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á‡∏à‡∏µ‡πã‡∏ñ‡∏∂‡∏á 105-106 ‡∏≠‡∏á‡∏®‡∏≤‡∏ü‡∏≤‡πÄ‡∏£‡∏ô‡πÑ‡∏Æ‡∏ï‡πå ‡∏ï‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡∏Å",
            // ‡∏î‡πà‡∏≤‡∏ô 5: ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡πÇ‡∏£‡∏Ñ
            "5-1": "‡∏¢‡∏≤‡πÄ‡∏û‡∏ô‡∏¥‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô (Penicillin) ‡πÄ‡∏õ‡πá‡∏ô‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡∏õ‡∏£‡∏≤‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
            "5-2": "‡∏¢‡∏≤‡∏≠‡∏∞‡∏°‡πá‡∏≠‡∏Å‡∏ã‡∏µ‡∏ã‡∏¥‡∏•‡∏•‡∏¥‡∏ô (Amoxicillin) ‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏î‡∏µ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô",
            "5-3": "Biosecurity ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°",
            "5-4": "‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏±‡πà‡∏ô‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ",
            "5-5": "‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏õ‡πÄ‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πá‡∏ö ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
            "5-6": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÇ‡∏£‡∏Ñ '‡∏Å‡∏•‡∏≤‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå' ‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠‡πÅ‡∏¢‡∏Å‡πÇ‡∏£‡∏Ñ‡πÉ‡∏´‡πâ‡∏î‡∏µ",
            "5-7": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏¥‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥",
            "5-8": "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏õ‡∏≠‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏≠‡∏î‡∏ö‡∏ß‡∏° ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å"
        };

        // --- AI API Logic ---
        async function fetchAIExplanation(term1, term2, pairId) {
            aiEmpty.classList.add('hidden');
            aiContent.classList.add('hidden');
            aiLoading.classList.remove('hidden');
            aiCorner.classList.add('ai-pulse');

            const cacheKey = [term1, term2].sort().join('||');

            if (pairId && backupKnowledge[pairId]) {
                currentExplanation = backupKnowledge[pairId];
                setTimeout(() => displayAIResult(currentExplanation), 500);
                return;
            }

            if (explanationCache[cacheKey]) {
                currentExplanation = explanationCache[cacheKey];
                displayAIResult(currentExplanation);
                return;
            }

            const fallbackText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á "${term1}" ‡πÅ‡∏•‡∏∞ "${term2}" ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÇ‡∏£‡∏Ñ S. suis`;

            try {
                const modelName = "gemini-1.5-flash";
                const prompt = `Explain the connection between '${term1}' and '${term2}' regarding Streptococcus suis in pigs/humans. Keep it very short, simple, fun, and educational for a Thai primary student. Max 2 short sentences in Thai language.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    currentExplanation = text;
                    explanationCache[cacheKey] = text;
                } else {
                    currentExplanation = fallbackText;
                }

            } catch (e) {
                console.error("AI Error:", e);
                currentExplanation = fallbackText + " (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)";
            }

            displayAIResult(currentExplanation);
        }

        function displayAIResult(text) {
            aiLoading.classList.add('hidden');
            aiCorner.classList.remove('ai-pulse');
            aiContent.classList.remove('hidden');
            aiText.innerText = text;
        }

        async function playAIAudio() {
            if (!currentExplanation) return;

            const btn = document.getElementById('btn-play-audio');
            const loading = document.getElementById('audio-loading');

            btn.disabled = true;
            btn.classList.add('opacity-50');
            loading.classList.remove('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Say in a teaching tone: " + currentExplanation }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: {
                                voiceConfig: {
                                    prebuiltVoiceConfig: {
                                        voiceName: "Aoede"
                                    }
                                }
                            }
                        }
                    })
                });

                if (!response.ok) throw new Error('TTS API Error');
                const data = await response.json();
                const audioBase64 = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;

                if (audioBase64) {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const binaryString = atob(audioBase64);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }

                    const wavBytes = pcm16ToWav(bytes, 24000);
                    const blob = new Blob([wavBytes], { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(blob);
                    const audio = new Audio(audioUrl);
                    audio.play();

                    audio.onended = () => {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50');
                    };
                } else {
                    throw new Error("No audio data");
                }
            } catch (e) {
                console.error("TTS Error:", e);
                const utterance = new SpeechSynthesisUtterance(currentExplanation);
                utterance.lang = 'th-TH';
                speechSynthesis.speak(utterance);
                btn.disabled = false;
                btn.classList.remove('opacity-50');
            } finally {
                loading.classList.add('hidden');
            }
        }

        function pcm16ToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const byteRate = sampleRate * numChannels * bitsPerSample / 8;
            const blockAlign = numChannels * bitsPerSample / 8;
            const wavHeader = new ArrayBuffer(44);
            const view = new DataView(wavHeader);

            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };

            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.length, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitsPerSample, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.length, true);

            const wavBody = new Uint8Array(wavHeader.byteLength + pcmData.length);
            wavBody.set(new Uint8Array(wavHeader), 0);
            wavBody.set(pcmData, wavHeader.byteLength);

            return wavBody;
        }

        // --- Knowledge Hub Logic ---
        const knowledgeData = {
            antibiotics: [
                {
                    title: "‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ (AMR)",
                    icon: "fa-exclamation-triangle",
                    color: "text-red-500",
                    content: `
                        <div class="mb-3">
                            <p class="mb-3">
                                ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (Overuse) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ú‡∏¥‡∏î‡∏ß‡∏¥‡∏ò‡∏µ (Misuse) ‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ß‡∏¥‡∏Å‡∏§‡∏ï <strong>"‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏ï‡πâ‡∏≤‡∏ô‡∏à‡∏∏‡∏•‡∏ä‡∏µ‡∏û" (AMR)</strong> ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" (One Health)
                            </p>
                            <div class="bg-red-50 p-4 rounded-md border-l-4 border-red-500 text-sm">
                                <strong>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:</strong> ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô <em>‡πÑ‡∏°‡πà‡∏Ü‡πà‡∏≤‡πÑ‡∏ß‡∏£‡∏±‡∏™ ‡πÑ‡∏°‡πà‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏•‡∏î‡πÑ‡∏Ç‡πâ</em> ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ú‡∏¥‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
                            </div>
                        </div>
                    `
                },
                {
                    title: "1. ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏£‡∏π‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏° (Fundamental Management)",
                    icon: "fa-shield-alt",
                    color: "text-blue-500",
                    content: `
                        <div class="mb-4">
                            <p class="mb-4">‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö Mindset ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢" ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏á‡∏Ñ‡πå‡∏£‡∏ß‡∏°:</p>
                            <ul class="list-disc pl-5 space-y-2">
                                <li><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û (Biosecurity):</strong> ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö "‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏°‡∏î-‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î" (All-in All-out) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£‡πÇ‡∏£‡∏Ñ</li>
                                <li><strong>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°:</strong> ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡πä‡∏≤‡∏ã‡πÅ‡∏≠‡∏°‡πÇ‡∏°‡πÄ‡∏ô‡∏µ‡∏¢ (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏ô 30-50 ppm) ‡∏ã‡∏∂‡πà‡∏á‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</li>
                                <li><strong>‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥:</strong> ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ñ‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏ï‡∏≤‡∏ö‡∏≠‡∏•‡∏¥‡∏ã‡∏∂‡∏°</li>
                                <li><strong>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏•‡∏≥‡πÑ‡∏™‡πâ:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏î‡∏µ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏¥‡πÄ‡∏ß‡∏®‡πÉ‡∏ô‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</li>
                            </ul>
                        </div>
                    `
                },
                {
                    title: "2. ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏î‡πÅ‡∏ó‡∏ô (Alternative Nutraceuticals)",
                    icon: "fa-seedling",
                    color: "text-green-500",
                    content: `
                         <div class="mb-4">
                            <p class="mb-4">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ "‡πÄ‡∏†‡∏™‡∏±‡∏ä‡πÇ‡∏†‡∏ä‡∏ô‡∏†‡∏±‡∏ì‡∏ë‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ (Prophylaxis) ‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞:</p>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-green-50 p-3 rounded">
                                <h4 class="font-bold text-green-700">2.1 ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô (Vaccines)</h4>
                                <p class="text-sm">‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡∏ï‡∏∏ ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞ ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</p>
                                </div>
                                <div class="bg-blue-50 p-3 rounded">
                                <h4 class="font-bold text-blue-700">2.2 Probiotics & Prebiotics</h4>
                                <p class="text-sm">‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏à‡∏∏‡∏•‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå‡∏•‡∏≥‡πÑ‡∏™‡πâ ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏≠‡∏á‡∏à‡∏∏‡∏•‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå‡∏î‡∏µ</p>
                                </div>
                                <div class="bg-yellow-50 p-3 rounded">
                                <h4 class="font-bold text-yellow-700">2.3 ‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£ (Phytogenics)</h4>
                                <p class="text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏Å‡∏¥‡∏ô, ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô, ‡∏ï‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö</p>
                                </div>
                                <div class="bg-purple-50 p-3 rounded">
                                <h4 class="font-bold text-purple-700">2.4 ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û</h4>
                                <p class="text-sm">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡∏¥‡πà‡∏ô (Autogenous), ‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡∏£‡∏¥‡πÇ‡∏≠‡πÄ‡∏ü‡∏à (Phage Therapy), ‡∏Å‡∏£‡∏î‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</p>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    title: "3. ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏±‡∏Å‡∏©‡πå (Scientific Evidence)",
                    icon: "fa-book-open",
                    color: "text-indigo-500",
                    content: `
                        <div class="mb-3">
                            <p class="mb-3">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏£‡∏ó‡∏î‡πÅ‡∏ó‡∏ô:</p>
                            <ul class="list-disc pl-5 mb-4 space-y-2">
                                <li><strong>Meta-analysis (Gabler N., 2017):</strong> ‡∏û‡∏ö‡∏ß‡πà‡∏≤ Probiotics ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï (ADG) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</li>
                                <li><strong>‡∏Å‡∏£‡∏ì‡∏µ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (Yamsakul et al., 2016):</strong> ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö "‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤" vs "‡∏¢‡∏≤ Colistin" ‡πÉ‡∏ô‡∏™‡∏∏‡∏Å‡∏£</li>
                            </ul>
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-sm text-left text-gray-500 border rounded-lg">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                    <tr>
                                    <th class="px-6 py-3">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á</th>
                                    <th class="px-6 py-3">ADG (‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-white border-b">
                                    <td class="px-6 py-4">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏¢‡∏≤/‡∏™‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°)</td>
                                    <td class="px-6 py-4">491.79</td>
                                    </tr>
                                    <tr class="bg-green-50 border-b font-semibold">
                                    <td class="px-6 py-4">‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤ 2 ‡∏Å‡∏Å./‡∏ï‡∏±‡∏ô</td>
                                    <td class="px-6 py-4 text-green-700">595.23</td>
                                    </tr>
                                    <tr class="bg-white border-b">
                                    <td class="px-6 py-4">‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞ Colistin 150 ppm</td>
                                    <td class="px-6 py-4">598.01</td>
                                    </tr>
                                </tbody>
                                </table>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">‡∏™‡∏£‡∏∏‡∏õ: ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏î‡∏µ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞ ‡πÅ‡∏•‡∏∞‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</p>
                        </div>
                    `
                }
            ],
            ssuis: [
                {
                    title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö",
                    icon: "fa-heartbeat",
                    color: "text-red-600",
                    content: `
                        <div>
                            <p>‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ <em>Streptococcus suis</em> (S. suis) ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Å‡∏£:</p>
                            <ul class="list-disc pl-5 mt-2">
                                <li><strong>‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</li>
                                <li><strong>‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç:</strong> ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏™‡∏π‡πà‡∏Ñ‡∏ô (Zoonosis) ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏´‡∏π‡∏î‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏ô</li>
                            </ul>
                        </div>
                    `
                },
                {
                    title: "1. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏î (Etiology & Epidemiology)",
                    icon: "fa-microscope",
                    color: "text-blue-600",
                    content: `
                        <div>
                            <h4 class="font-bold text-gray-800 mb-2">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</h4>
                            <p class="mb-2">‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏ß‡∏Å ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏° (Coccus) ‡∏°‡∏µ‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏• (‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á) ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà ‡∏û‡∏ö 29 ‡∏ã‡∏µ‡πÇ‡∏£‡πÑ‡∏ó‡∏õ‡πå ‡πÇ‡∏î‡∏¢ <strong>Serotype 2</strong> ‡∏Å‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
                            
                            <h4 class="font-bold text-gray-800 mb-2 mt-4">‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏î</h4>
                            <p className="mb-2">‡∏™‡∏∏‡∏Å‡∏£‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏≤‡∏´‡∏∞ (Carrier) ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏≠‡∏™‡∏∏‡∏Å‡∏£‡∏´‡∏¢‡πà‡∏≤‡∏ô‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (5-10 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</p>
                            <ul class="list-disc pl-5 bg-gray-50 p-3 rounded">
                                <li><strong>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡∏≥:</strong> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î, ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô, ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πÑ‡∏°‡πà‡∏î‡∏µ, ‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ï‡∏Å</li>
                                <li><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏ä‡∏∑‡πâ‡∏≠:</strong> ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏à‡∏°‡∏π‡∏Å‡∏ï‡πà‡∏≠‡∏à‡∏°‡∏π‡∏Å, ‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô, ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô</li>
                            </ul>
                        </div>
                    `
                },
                {
                    title: "2. ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ (Clinical Signs & Pathology)",
                    icon: "fa-stethoscope",
                    color: "text-purple-600",
                    content: `
                        <div>
                            <h4 class="font-bold text-gray-800">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</h4>
                            <p class="mb-2">‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á (40.5-41.5 ¬∞C), ‡∏ï‡∏≤‡∏¢‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô</p>
                            <ul class="list-disc pl-5 mb-4">
                                <li><strong>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó:</strong> ‡∏ä‡∏±‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏á, ‡∏ô‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏∏‡∏¢‡∏Ç‡∏≤, ‡∏Ñ‡∏≠‡πÅ‡∏Ç‡πá‡∏á‡πÄ‡∏Å‡∏£‡πá‡∏á (Meningitis)</li>
                                <li><strong>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠:</strong> ‡∏Ç‡πâ‡∏≠‡∏ö‡∏ß‡∏°‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö, ‡∏Ç‡∏≤‡πÄ‡∏à‡πá‡∏ö ‡πÄ‡∏î‡∏¥‡∏ô‡∏Å‡∏∞‡πÄ‡∏ú‡∏•‡∏Å</li>
                            </ul>

                            <h4 class="font-bold text-gray-800">‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ã‡∏≤‡∏Å)</h4>
                            <ul class="list-disc pl-5">
                                <li>‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏°‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏∏‡πà‡∏ô‡∏´‡∏ô‡∏≤ ‡∏°‡∏µ‡∏´‡∏ô‡∏≠‡∏á</li>
                                <li>‡∏Ç‡πâ‡∏≠‡∏ö‡∏ß‡∏° ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏≠‡∏á</li>
                                <li><strong>Fibrinous Polyserositis:</strong> ‡∏°‡∏µ‡πÑ‡∏ü‡∏ö‡∏£‡∏¥‡∏ô‡∏õ‡∏Å‡∏Ñ‡∏•‡∏∏‡∏°‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡∏õ‡∏≠‡∏î</li>
                            </ul>
                        </div>
                    `
                },
                {
                    title: "3. ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Treatment & Control)",
                    icon: "fa-pills",
                    color: "text-green-600",
                    content: `
                        <div class="space-y-4">
                            <div class="border-l-4 border-blue-500 pl-4">
                                <h4 class="font-bold text-gray-800">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</h4>
                                <p class="text-sm">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ + ‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏•‡πá‡∏ö (‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ PCR)</p>
                            </div>
                            
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-bold text-gray-800">‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</h4>
                                <p class="text-sm">‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° Beta-lactams (‡πÄ‡∏ä‡πà‡∏ô Penicillin, Amoxicillin) ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</p>
                            </div>

                            <div class="border-l-4 border-orange-500 pl-4">
                                <h4 class="font-bold text-gray-800">‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô</h4>
                                <p class="text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Biosecurity, ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î, ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p>
                            </div>
                        </div>
                    `
                }
            ]
        };

        let currentTab = 'antibiotics';
        let openAccordionIndex = null;

        function switchTab(tab) {
            currentTab = tab;
            openAccordionIndex = null; // Reset accordion
            renderKnowledgeUI();
        }

        function toggleAccordion(index) {
            openAccordionIndex = openAccordionIndex === index ? null : index;
            renderKnowledgeUI();
        }

        function renderKnowledgeUI() {
            // Update Tabs
            const tabAntibiotics = document.getElementById('tab-antibiotics');
            const tabSsuis = document.getElementById('tab-ssuis');

            if (currentTab === 'antibiotics') {
                tabAntibiotics.className = "flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 bg-white text-indigo-700 shadow-sm";
                tabSsuis.className = "flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 text-gray-600 hover:text-gray-800";

                document.getElementById('section-title').innerText = "‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞";
                document.getElementById('section-subtitle').innerText = "‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏®‡∏∏‡∏™‡∏±‡∏ï‡∏ß‡πå";
            } else {
                tabAntibiotics.className = "flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 text-gray-600 hover:text-gray-800";
                tabSsuis.className = "flex-1 py-3 px-4 rounded-md text-sm font-semibold transition-all duration-200 bg-white text-red-700 shadow-sm";

                document.getElementById('section-title').innerText = "‡πÇ‡∏£‡∏Ñ‡∏™‡πÄ‡∏ï‡∏£‡∏õ‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏Ñ‡∏Ñ‡∏±‡∏™ ‡∏ã‡∏π‡∏≠‡∏¥‡∏™ (S. suis)";
                document.getElementById('section-subtitle').innerText = "‡∏£‡∏∞‡∏ö‡∏≤‡∏î‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ";
            }

            // Render Accordion
            const container = document.getElementById('accordion-container');
            container.innerHTML = '';

            const items = knowledgeData[currentTab];
            items.forEach((item, index) => {
                const isOpen = openAccordionIndex === index;
                const div = document.createElement('div');
                div.className = "border border-gray-200 rounded-lg mb-3 overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200 bg-white";

                div.innerHTML = `
                    <button onclick="toggleAccordion(${index})"
                        class="w-full flex items-center justify-between p-4 text-left transition-colors duration-200 ${isOpen ? 'bg-blue-50 text-blue-700' : 'bg-white text-gray-700 hover:bg-gray-50'}">
                        <div class="flex items-center gap-3">
                            <i class="fas ${item.icon} text-lg ${isOpen ? 'text-blue-600' : 'text-gray-400'}"></i>
                            <span class="font-semibold text-base md:text-lg">${item.title}</span>
                        </div>
                        <i class="fas ${isOpen ? 'fa-chevron-up' : 'fa-chevron-down'} ${isOpen ? 'text-blue-600' : 'text-gray-400'}"></i>
                    </button>
                    ${isOpen ? `
                        <div class="p-5 bg-white text-gray-600 leading-relaxed border-t border-gray-100 animate-fadeIn">
                            ${item.content}
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        // Initialize Knowledge UI
        renderKnowledgeUI();

        // --- Timer Logic ---
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                totalSeconds++;
                updateTimeDisplay();
            }, 1000);
        }

        function updateTimeDisplay() {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            timeDisplay.innerText = `${mins}:${secs}`;
        }

        function resetLevelStats() {
            moves = 0;
            seconds = 0;
            matchedPairs = 0;
            gameStarted = false;
            clearInterval(timerInterval);

            movesDisplay.innerText = '0';
            timeDisplay.innerText = '00:00';

            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        // --- Game Flow Control ---
        function levelComplete() {
            clearInterval(timerInterval);

            document.getElementById('modal-level-num').innerText = currentLevelIndex + 1;
            document.getElementById('level-time').innerText = timeDisplay.innerText;
            document.getElementById('level-moves').innerText = moves;

            if (currentLevelIndex < levelsData.length - 1) {
                document.getElementById('modal-msg').innerText = "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ";
                levelModal.classList.remove('hidden');
            } else {
                showVictory();
            }
        }

        function nextLevel(isLocalAction = true) {
            if (isLocalAction && isMultiplayer) sendGameAction('NEXT_LEVEL', {});
            levelModal.classList.add('hidden');
            initGame(currentLevelIndex + 1);
        }

        function showVictory() {
            const mins = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const secs = (totalSeconds % 60).toString().padStart(2, '0');
            document.getElementById('total-time').innerText = `${mins}:${secs}`;

            victoryModal.classList.remove('hidden');
        }

        function restartGame(isLocalAction = true) {
            if (isLocalAction && isMultiplayer) sendGameAction('RESTART', {});
            victoryModal.classList.add('hidden');
            welcomeScreen.classList.remove('hidden'); // Show Welcome screen on full restart
            gameContainer.classList.add('hidden');
            totalSeconds = 0;
        }

        // --- MQTT Functions ---
        function openMultiplayerModal() {
            if (isMultiplayer) {
                if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    disconnectMQTT();
                }
            } else {
                document.getElementById('multiplayer-modal').classList.remove('hidden');
            }
        }

        function connectMQTT() {
            const input = document.getElementById('room-id-input').value.trim();
            if (!input) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á");

            roomId = input;
            document.getElementById('multiplayer-modal').classList.add('hidden');

            const btn = document.getElementById('btn-multiplayer');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';

            mqttClient = new Paho.MQTT.Client("broker.emqx.io", 8083, myClientId);
            mqttClient.onConnectionLost = onConnectionLost;
            mqttClient.onMessageArrived = onMessageArrived;

            mqttClient.connect({
                onSuccess: onConnect,
                onFailure: onFailure,
                keepAliveInterval: 30
            });
        }

        function onConnect() {
            console.log("MQTT Connected");
            isMultiplayer = true;
            const btn = document.getElementById('btn-multiplayer');
            btn.className = "bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-full shadow-sm border border-green-200 flex items-center transition-colors";
            btn.innerHTML = `<i class="fas fa-circle text-xs text-green-500 mr-2"></i> ‡∏´‡πâ‡∏≠‡∏á: ${roomId}`;
            mqttClient.subscribe(`ssuis-game/${roomId}/action`);
        }

        function onFailure(responseObject) {
            alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + responseObject.errorMessage);
            resetMultiplayerUI();
        }

        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("Connection Lost: " + responseObject.errorMessage);
            }
            resetMultiplayerUI();
        }

        function disconnectMQTT() {
            if (mqttClient) {
                mqttClient.disconnect();
            }
            resetMultiplayerUI();
        }

        function resetMultiplayerUI() {
            isMultiplayer = false;
            const btn = document.getElementById('btn-multiplayer');
            btn.className = "bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-full shadow-sm border border-blue-200 flex items-center transition-colors";
            btn.innerHTML = `<i class="fas fa-users mr-2"></i> ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô`;
        }

        function sendGameAction(type, payload) {
            if (!mqttClient || !isMultiplayer) return;

            const message = new Paho.MQTT.Message(JSON.stringify({
                sender: myClientId,
                type: type,
                payload: payload
            }));
            message.destinationName = `ssuis-game/${roomId}/action`;
            mqttClient.send(message);
        }

        function onMessageArrived(message) {
            try {
                const data = JSON.parse(message.payloadString);
                if (data.sender === myClientId) return;

                console.log("Received:", data);

                switch (data.type) {
                    case 'FLIP':
                        handleRemoteFlip(data.payload.cardIndex);
                        break;
                    case 'START_TIMER':
                        if (!gameStarted) {
                            startTimer();
                            gameStarted = true;
                        }
                        break;
                    case 'NEXT_LEVEL':
                        nextLevel(false);
                        break;
                    case 'RESTART':
                        restartGame(false);
                        break;
                }
            } catch (e) {
                console.error("Msg Parse Error", e);
            }
        }

        function handleRemoteFlip(index) {
            const cardContainer = gameBoard.children[index];
            if (cardContainer) {
                const card = cardContainer.querySelector('.card');
                if (card && !card.classList.contains('flipped')) {
                    flipCard(card, false);
                }
            }
        }
    </script>
</body>

</html>
